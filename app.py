# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PWnxL2zJ6dft07X-eiG11DPt9dfdLgY_
"""

import streamlit as st
import pandas as pd
import joblib

#page settings
st.set_page_config(
    page_title="Zomato Food Delivery Time Predictor",
    page_icon="ğŸ…",
    layout="wide"
)

st.title("ğŸ… Smart Food Delivery Time Predictor")
st.markdown("Zomato Food Delivery Prediction based on Conditions")

#keep image
st.image("zomato_driver.jpeg",use_container_width=True)

st.divider()

#model
@st.cache_resource
def load_artifacts():
    model = joblib.load("delivery_time_model.pkl")
    model_columns = joblib.load("model_columns.pkl")
    return model, model_columns

model, model_columns = load_artifacts()

#split page
left, right = st.columns([1, 1])

#left page
with left:

    st.subheader("ğŸ“Š Enter Delivery Details")

    delivery_dist_km = st.number_input(
        "ğŸ“ Distance (km)",
        min_value=0.1,
        max_value=1000.0,
        value=5.0
    )

    delivery_person_age = st.number_input(
        "ğŸ‘¤ Delivery Person Age",
        min_value=18,
        max_value=60,
        value=25
    )

    driver_rating = st.slider(
        "â­ Driver Rating",
        min_value=1.0,
        max_value=5.0,
        value=4.5,
        step=0.1
    )

    vehicle_condition = st.slider(
        "ğŸ›µ Vehicle Condition (0 = Worst, 5 = Best)",
        0, 5, 3
    )

    multiple_deliveries = st.slider(
        "ğŸ“¦ Multiple Deliveries",
        min_value=1,
        max_value=5,
        value=1
    )

    city = st.selectbox(
        "ğŸ™ï¸ City Type",
        ["Urban", "Metropolitan", "Semi-Urban"]
    )

    road_traffic_density = st.selectbox(
        "ğŸš¦ Traffic Level",
        ["Low", "Medium", "High", "Jam"]
    )

    weather_conditions = st.selectbox(
        "ğŸŒ¦ï¸ Weather Conditions",
        ["Sunny", "Cloudy", "Stormy", "Fog"]
    )

    predict_button = st.button("ğŸš€ Predict Delivery Time")

#right page
with right:

    st.subheader("ğŸ¤– Prediction Result")

    # toggle explanation
    show_model_info = st.toggle(
        "Show Machine Learning Model Explanation"
    )

    if show_model_info:
        st.info("""
Machine Learning Model predicts delivery time based on:

- Driver's rating
- Driver's age
- Delivery distance
- Vehicle Condition

Note, delivery is longer when:

- Driver age is above 28
- Driver rating is below 5
- Delivery distance above 10 km
- Vehicle condition is bad
- Multiple deliveries
- Weather is cloudy and foggy
""")

    if predict_button:

        input_df = pd.DataFrame({
            "delivery_dist_km": [delivery_dist_km],
            "delivery_person_age": [delivery_person_age],
            "driver_rating": [driver_rating],
            "vehicle_condition": [vehicle_condition],
            "multiple_deliveries": [multiple_deliveries],
            "city": [city],
            "road_traffic_density": [road_traffic_density],
            "weather_conditions": [weather_conditions]
        })

        # encoding
        input_encoded = pd.get_dummies(input_df)
        input_encoded = input_encoded.reindex(
            columns=model_columns,
            fill_value=0
        )

        prediction = model.predict(input_encoded)[0]

        st.success(
            f"â±ï¸ Estimated Delivery Time: **{prediction:.2f} minutes**"
        )


        if prediction < 15:
          st.balloons()
          st.success("ğŸš€ **Fast Delivery** â€” Order is expected to arrive very quickly with excellent efficiency.")

        elif 15 <= prediction <= 32:
          st.info("âœ… **Average Delivery Time** â€” Delivery is operating within normal service expectations.")

        elif 33 <= prediction <= 40:
          st.warning("âš ï¸ **Delayed Delivery Risk** â€” Some slowdown detected. Customer wait time may increase.")

        else:
          st.error("ğŸš¨ **Severely Delayed Delivery** â€” High likelihood of late arrival. Over to productive driver is recommended")